# SNOmodels

## Introduction

this Snakemake pipeline is designed to calculate properties of interest on
cysteine residues, in particular considering pairs of them corresponding to
one S-nistrosylation site and a proximal cysteine residue. Properties are
calculated on ensemble PDB files generated by CABSflex. In particular, for both
cysteine residues, the pipeline calcualates:

  - X1 dihedral angle for both SNO and proximal Cys
  - CG(SNO)-SG(SNO)-SG(proxi)-CG(proxi) dihedral angle
  - distance between SG atoms of the two Cysteine residues
  - pKa prediction for both Cys residues, calculated using propKa
  - side-chain relative solvent accessible surface area for both cysteine
  residues, calculated using NACCESS

Results are written as csv files and plot, indipendently for every protein.
Finally a comprehensive statistics file is written in the results folder.

The pipeline is designed to work con CABSflex ensembles derived from either
wild-type or mutated structures (see more details below) that were originally
downloaded from the AlphaFold Protein Structure Database.

## Requirements

In order to perform the analysis you will need to have:

  - Python >=3.7 with packages snakemake, numpy, pandas, MDAnalysis, matplotlib
  - NACCESS
  - propKa

By default, the pipeline reads an input csv file (proteins.csv) with the following
columns. Each column represents a CABSflex run which should be available
according to a specific directory structure (see below.)

| Column name | Description |
| ----------- | ----------- |
| `up_ac` | UniProt AC of the protein of interest |
| `hugo` | HUGO symbol of the corresponding gene |
| `start` | first residue number of the protein of interest in the structure used by CABSflex |
| `end` | last residue number of the protein of interest in the structure used by CABSflex |
| `restraints_set` | name of the restraint set used in CABSflex |
| `mutation` | mutation present in the starting structure usde in CABSflex. Can be either `WT` or a single-letter mutation format (e.g. `Q45F`) |
| `dir_name` | name of the directory where this CABSdock run is stored | 
| `chain` | chain name of the protein of interest in the structure used by CABSflex | 

The pipeline expects one PDB file containing the CABSflex structural ensemble,
with the following path:

```
{runs_basedir}/{dir_name}/af{hugo}_{chain}_{start}-{end}_{mut}/af2db/{restraints_set}/theseus/theseus_sup.pdb"```
```

the runs_basedir parameter can be configured directly in the Snakefile file.

the name of the PDB file depends on the fact that the theseus software has been
used to generate the ensembles starting from single structure files as written
by CABSflex.

SNOmodels also reads another csv file, from which the information on which 
SNO-proximal Cysteine pairs should be considered for every system. This is 
a direct output of the SNOfinder pipeline and should contain at least the
following columns:

| Column name | Description |
| ----------- | ----------- |
| `up_id` | UniProt ID of the protein of interest |
| `up_ac` | UniProt AC of the protein of interest |
| `residue` | Residue number of the SNO Cysteine |
| `proximal_cys` | Residue number of the proximal Cysteine  |

## Output

the pipeline writes all results in the `results` directory. Each SNO pair for
each system listed in the `proteins.csv` file is present as a separate folder,
with the following naming convention:

{dir_name}_{hugo}_{up_ac}_{chain}_{start}-{end}_{restraint_set}_SNO-{residue}_CYS-{proximal_cys}_{mutation}

each folder contains:
  - a `data.csv` file which contains all the available measures as previously
    described
  - `distributions.pdf` and `values.pdf` which are graphical representations
    of the aforamentioned data

finally, a `results/statistics.csv` file contains mean and standard deviation
for all the calculated parameters for every case

## Performing the analysis

1. Activate the appropriate Python environment if needed

. /usr/local/envs/py37/bin/activate

2. run all the steps of the pipeline:

snakemake -c 12